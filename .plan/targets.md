# ä»»åŠ¡ç›®æ ‡ï¼š
åŸºäº LLM+çŸ¥è¯†å›¾è°± çš„agenté¡¹ç›®ã€‚
éœ€è¦æœ‰**diet_candidate_generator**(é¥®é£Ÿå€™é€‰æ–¹æ¡ˆç”Ÿæˆå™¨), **exer_candidate_generator**(è¿åŠ¨å€™é€‰æ–¹æ¡ˆç”Ÿæˆå™¨),**safeguard**(é£é™©è¯„ä¼°æ¨¡å—)ä¸‰ä¸ªåŸºäº{çŸ¥è¯†å›¾è°±, LLM, prompt_engineering, parser_rules}çš„æ¨¡å—ã€‚
å…¶ä¸­**diet_candidate_generator**, **exer_candidate_generator**ç”¨äºåœ¨é¥®é£Ÿ/è¿åŠ¨çŸ¥è¯†å›¾è°±æŒ‡å¯¼ä¸‹ç”Ÿæˆæ–¹æ¡ˆé‡‡æ ·ã€‚éšåæ–¹æ¡ˆä¼šç»è¿‡ä¸€ç³»åˆ—å¤„ç†å’Œå˜æ¢ï¼Œå†ç”±**safeguard**è¡¡é‡åè¾“å‡ºã€‚

æ–¹æ¡ˆç”Ÿæˆæ”¯æŒï¼š
1. æ ¹æ®ç”¨æˆ·metadataï¼ˆç”Ÿç†æŒ‡æ ‡ï¼‰ã€å½“å‰çš„ç¯å¢ƒå˜é‡ï¼ˆå¤©æ°”/æ—¥æœŸ/æ—¶é—´ï¼‰ç”Ÿæˆå¤šä¸ªå€™é€‰æ–¹æ¡ˆ
2. æ ¹æ®ç”¨æˆ·metadataï¼ˆç”Ÿç†æŒ‡æ ‡ï¼‰ã€å½“å‰çš„ç¯å¢ƒå˜é‡ï¼ˆå¤©æ°”/æ—¥æœŸ/æ—¶é—´ï¼‰ä¸ç”¨æˆ·çš„éœ€æ±‚ç”Ÿæˆå¤šä¸ªå€™é€‰æ–¹æ¡ˆ

é£é™©è¯„ä¼°æ¨¡å—æ”¯æŒï¼š
1. å¯¹äºç»™å‡ºçš„ç”¨æˆ·metadataï¼ˆç”Ÿç†æŒ‡æ ‡ï¼‰ã€å½“å‰çš„ç¯å¢ƒå˜é‡ï¼ˆå¤©æ°”/æ—¥æœŸ/æ—¶é—´ï¼‰å’Œå…·ä½“æ–¹æ¡ˆï¼Œè¾“å‡ºä¸€ä¸ª{0-100åˆ†çš„æ ‡é‡/True or Falseçš„åˆ¤æ–­}ï¼Œåˆ¤å®šæ–¹æ¡ˆæ˜¯å¦å®‰å…¨ã€‚

---

# å½“å‰è¿›åº¦ï¼šMilestone 1 + Milestone 2 å·²å®Œæˆ âœ…

## å·²å®ŒæˆåŠŸèƒ½

### Diet Candidate Generator (é¥®é£Ÿå€™é€‰æ–¹æ¡ˆç”Ÿæˆå™¨)
- âœ… **LLM-basedé¥®é£Ÿç”Ÿæˆ**: ç§»é™¤ç¡¬ç¼–ç FOOD_DATABASEï¼Œæ”¹ç”¨LLMåŠ¨æ€ç”Ÿæˆ
- âœ… **Pydantic JSON Schema**: å®šä¹‰äº†FoodItem, MealPlanItem, DietRecommendationç­‰ç»“æ„åŒ–è¾“å‡ºæ¨¡å‹
- âœ… **Harris-Benedict BMRè®¡ç®—**: è‡ªåŠ¨è®¡ç®—ç›®æ ‡çƒ­é‡
- âœ… **ç–¾ç—…çº¦æŸå¤„ç†**: ç³–å°¿ç—…/é«˜è¡€å‹/é«˜è¡€è„‚ç­‰é¥®é£Ÿé™åˆ¶
- âœ… **ç¯å¢ƒé€‚åº”**: æ ¹æ®å­£èŠ‚/å¤©æ°”è°ƒæ•´é¥®é£Ÿå»ºè®®
- âœ… **å¤šå€™é€‰ç”Ÿæˆ**: æ”¯æŒç”Ÿæˆå¤šä¸ªé¥®é£Ÿæ–¹æ¡ˆå€™é€‰

### Exercise Candidate Generator (è¿åŠ¨å€™é€‰æ–¹æ¡ˆç”Ÿæˆå™¨)
- âœ… **ExerciseAgentMixin**: è¿åŠ¨çŸ¥è¯†å›¾è°±æŸ¥è¯¢ + 8ç§ç–¾ç—…çŸ¥è¯†åº“
- âœ… **ExercisePlanæ¨¡å‹**: ExerciseItem, Session, WeeklyPlanç»“æ„
- âœ… **ç›®æ ‡è®¡ç®—**: å¡è·¯é‡Œ/æ—¶é•¿/é¢‘ç‡è‡ªåŠ¨è®¡ç®—
- âœ… **LLMç”Ÿæˆ**: JSONè§„èŒƒåŒ–, æšä¸¾å€¼æ ‡å‡†åŒ–
- âœ… **METçƒ­é‡ä¼°ç®—**: 30+è¿åŠ¨çš„METå€¼åº“
- âœ… **CLIæµ‹è¯•**: `python run.py exercise`

### Safeguard Agent (åŸºç¡€ç‰ˆ)
- âœ… **SafetyAssessmentæ¨¡å‹**: è¯„åˆ†/å®‰å…¨åˆ¤æ–­/é£é™©å› ç´ 
- âœ… **è§„åˆ™æ£€æŸ¥**: çƒ­é‡èŒƒå›´ã€å®é‡æ¯”ä¾‹ã€æ—¶é•¿é™åˆ¶
- âœ… **ç–¾ç—…çº¦æŸ**: 5ç§ç–¾ç—…(ç³–å°¿ç—…/é«˜è¡€å‹/å¿ƒè„ç—…/è‚¥èƒ–/å…³èŠ‚ç‚)
- âœ… **ç¯å¢ƒæ£€æŸ¥**: æ¸©åº¦/å¤©æ°”é£é™©
- âœ… **LLMè¯­ä¹‰è¯„ä¼°**: è¡¥å……è§„åˆ™æ£€æŸ¥é—æ¼
- âœ… **Pipelineé›†æˆ**: é¥®é£Ÿ+è¿åŠ¨+è¯„ä¼°

---

# Milestone 3: Safeguard å®Œå–„ä¸æµ‹è¯• (è¿›è¡Œä¸­)

## ç°çŠ¶åˆ†æ

### å½“å‰å®ç° (agents/safeguard/)

| ç»„ä»¶ | æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| è¯„ä¼°å™¨ | `assessor.py` | âš ï¸ åŸºç¡€ç‰ˆ | éœ€é€‚é…çœŸå®æ•°æ®æ¨¡å‹, éœ€é›†æˆKG |
| æ•°æ®æ¨¡å‹ | `models.py` | âœ… | å®Œæ•´çš„Pydanticæ¨¡å‹ |
| Pipeline | `health_pipeline.py` | âœ… | å·²é›†æˆsafeguard |

### å·²çŸ¥é—®é¢˜

1. **æ•°æ®æ¨¡å‹é€‚é…**: `_check_diet_safety` ä½¿ç”¨ `total_calories`, `macro_nutrients` å­—æ®µåä¸ `DietRecommendation` ä¸åŒ¹é…
2. **æ•°æ®æ¨¡å‹é€‚é…**: `_check_exercise_safety` ä½¿ç”¨ `total_duration_minutes`, `sessions` å­—æ®µåä¸ `ExercisePlan` ä¸åŒ¹é…
3. **KGæœªé›†æˆ**: æœªæŸ¥è¯¢ `Target_Avoid`, `Interaction` ç­‰ç¦å¿Œå…³ç³»
4. **ç–¾ç—…è¦†ç›–ä¸è¶³**: ä»…5ç§ç–¾ç—…ï¼Œéœ€æ‰©å±•è‡³12+
5. **ç¼ºä¹æµ‹è¯•**: æ— å•å…ƒæµ‹è¯•

---

## ä»»åŠ¡æ¸…å•

### Task #1: æ•°æ®æ¨¡å‹é€‚é…
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜ | **é¢„ä¼°æ—¶é—´**: 30min

**ç›®æ ‡**: ä¿®å¤assessorä¸ç”Ÿæˆå™¨è¾“å‡ºçš„å­—æ®µåä¸åŒ¹é…é—®é¢˜

**å½“å‰é—®é¢˜**:
```python
# assessor.py æœŸæœ›çš„å­—æ®µ
plan.get("total_calories")
plan.get("macro_nutrients")
plan.get("total_duration_minutes")
plan.get("sessions")

# DietRecommendation å®é™…çš„å­—æ®µ
recommendation.total_calories
recommendation.macro_nutrients  # ç»“æ„ä¸åŒ: {protein_ratio, carbs_ratio, fat_ratio}
```

**å®ç°æ­¥éª¤**:
1. åˆ†æ `DietRecommendation` å’Œ `ExercisePlan` çš„å®é™…è¾“å‡ºç»“æ„
2. æ›´æ–° `_check_diet_safety` ä½¿ç”¨æ­£ç¡®çš„å­—æ®µè·¯å¾„
3. æ›´æ–° `_check_exercise_safety` ä½¿ç”¨æ­£ç¡®çš„å­—æ®µè·¯å¾„
4. æ·»åŠ å­—æ®µå…¼å®¹å±‚ (å…¼å®¹æ—§æ ¼å¼ + æ–°æ ¼å¼)

**éªŒæ”¶æ ‡å‡†**:
- [ ] `python -m agents.safeguard.assessor` è¿è¡Œä¸æŠ¥é”™
- [ ] èƒ½æ­£ç¡®è¯»å–DietRecommendationçš„total_calories
- [ ] èƒ½æ­£ç¡®è¯»å–ExercisePlançš„total_duration

**æ–‡ä»¶**: `agents/safeguard/assessor.py`

---

### Task #2: çŸ¥è¯†å›¾è°±ç¦å¿ŒæŸ¥è¯¢
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜ | **é¢„ä¼°æ—¶é—´**: 1h

**ç›®æ ‡**: é›†æˆKGæŸ¥è¯¢ï¼Œè·å–Target_Avoid, Interactionç­‰ç¦å¿Œå…³ç³»

**KGå…³ç³»ç±»å‹**:
```cypher
# é¥®é£ŸKG
(diet)-[:Target_Avoid]->(disease)    // ç–¾ç—…ç¦å¿Œ
(food)-[:Interaction]->(food)       // é£Ÿç‰©ç›¸äº’ä½œç”¨
(nutrient)-[:Has_Risk]->(condition)  // è¥å…»é£é™©

# è¿åŠ¨KG
(exercise)-[:Target_Avoid]->(disease)  // è¿åŠ¨ç¦å¿Œ
(exercise)-[:Interaction]->(exercise)   // è¿åŠ¨å†²çª
```

**å®ç°æ­¥éª¤**:
1. åœ¨ `assessor.py` æ·»åŠ  `query_kg_contradictions()` æ–¹æ³•
2. æŸ¥è¯¢ç”¨æˆ·ç–¾ç—…ç›¸å…³çš„ç¦å¿Œå…³ç³»
3. æ£€æŸ¥æ–¹æ¡ˆå†…å®¹æ˜¯å¦åŒ…å«ç¦å¿Œé¡¹
4. é›†æˆåˆ° `_check_condition_restrictions()`

**æŸ¥è¯¢ç¤ºä¾‹**:
```python
def query_kg_contradictions(self, plan_type: str, conditions: List[str]):
    """Query KG for contraindications based on user conditions"""
    if plan_type == "diet":
        query = """
        MATCH (d:Disease)<-[:Target_Avoid]-(food)
        WHERE d.name IN $conditions
        RETURN food.name as forbidden_food
        """
    # ...
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] èƒ½ä»Neo4jæŸ¥è¯¢Target_Avoidå…³ç³»
- [ ] èƒ½è¯†åˆ«æ–¹æ¡ˆä¸­çš„ç¦å¿Œé£Ÿç‰©/è¿åŠ¨
- [ ] å°†KGå‘ç°è½¬åŒ–ä¸ºRiskFactor

**æ–‡ä»¶**: `agents/safeguard/assessor.py`, `core/neo4j/query.py`

---

### Task #3: ç–¾ç—…è¦†ç›–æ‰©å±•
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­ | **é¢„ä¼°æ—¶é—´**: 45min

**ç›®æ ‡**: å°†CONDITION_RESTRICTIONSä»5ç§æ‰©å±•è‡³12+ç§

**å½“å‰è¦†ç›–**: ç³–å°¿ç—…ã€é«˜è¡€å‹ã€å¿ƒè„ç—…ã€è‚¥èƒ–ã€å…³èŠ‚ç‚

**æ–°å¢ç–¾ç—…**:
| ç–¾ç—… | é¥®é£Ÿé™åˆ¶ | è¿åŠ¨é™åˆ¶ |
|------|---------|---------|
| é«˜è¡€è„‚ (hyperlipidemia) | ä½èƒ†å›ºé†‡, é™åˆ¶é¥±å’Œè„‚è‚ª | æœ‰æ°§è¿åŠ¨ä¸ºä¸» |
| éª¨è´¨ç–æ¾ (osteoporosis) | é«˜é’™, ç»´ç”Ÿç´ D | è´Ÿé‡è¿åŠ¨, é¿å…å¼¯è…° |
| å“®å–˜ (asthma) | æ— ç‰¹æ®Šé™åˆ¶ | é¿å…å†·ç©ºæ°”è¿åŠ¨ |
| ç—›é£ (gout) | ä½å˜Œå‘¤, å¤šé¥®æ°´ | é¿å…å‰§çƒˆè¿åŠ¨ |
| èƒƒæºƒç–¡ (ulcer) | é¿å…è¾›è¾£, åˆ†é¤åˆ¶ | é¿å…ç©ºè…¹è¿åŠ¨ |
| ç”²çŠ¶è…ºåŠŸèƒ½å¼‚å¸¸ (thyroid) | æ ¹æ®ç”²äº¢/ç”²å‡è°ƒæ•´ | é¿å…è¿‡åº¦åŠ³ç´¯ |
| æ…¢æ€§è‚¾ç—… (kidney_disease) | ä½è›‹ç™½, ä½é’  | æ¸©å’Œè¿åŠ¨ |
| è´«è¡€ (anemia) | é«˜é“é£Ÿç‰© | é¿å…å‰§çƒˆè¿åŠ¨ |

**å®ç°æ­¥éª¤**:
1. æ·»åŠ æ–°ç–¾ç—…åˆ° `CONDITION_RESTRICTIONS`
2. æ·»åŠ ç–¾ç—…åç§°å˜ä½“æ˜ å°„ (hypertension -> é«˜è¡€å‹)
3. æ›´æ–° `_check_condition_restrictions()` æ”¯æŒæ–°ç–¾ç—…
4. æµ‹è¯•è‡³å°‘3ç§æ–°å¢ç–¾ç—…çš„æ£€æŸ¥

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ”¯æŒ12ç§ä»¥ä¸Šç–¾ç—…
- [ ] ç³–å°¿ç—…ç”¨æˆ·çš„é«˜ç³–é£Ÿç‰©æ£€æµ‹
- [ ] å¿ƒè„ç—…æ‚£è€…çš„é«˜å¼ºåº¦è¿åŠ¨æ£€æµ‹

**æ–‡ä»¶**: `agents/safeguard/assecutor.py` lines 80-120

---

### Task #4: å¹´é¾„ä¸BMIé£é™©æ£€æŸ¥
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­ | **é¢„ä¼°æ—¶é—´**: 30min

**ç›®æ ‡**: æ·»åŠ å¹´é¾„ç›¸å…³çš„å®‰å…¨æ£€æŸ¥ (è€å¹´äºº/é’å°‘å¹´)

**è§„åˆ™**:
| å¹´é¾„æ®µ | é™åˆ¶ |
|--------|------|
| < 18 | éœ€ç›‘æŠ¤äººæŒ‡å¯¼, é¿å…é«˜å¼ºåº¦ |
| 60-70 | é¿å…é«˜å¼ºåº¦, æ³¨æ„å¿ƒç‡ |
| > 70 | é™åˆ¶æ—¶é•¿, é¿å…é«˜å†²å‡» |

**BMIç›¸å…³**:
- BMI < 18.5: å¢åŠ çƒ­é‡æ‘„å…¥å»ºè®®
- BMI > 30: é¿å…é«˜å†²å‡»è¿åŠ¨

**å®ç°æ­¥éª¤**:
1. æ·»åŠ  `_check_age_restrictions()` æ–¹æ³•
2. æ·»åŠ  `_check_bmi_considerations()` æ–¹æ³•
3. é›†æˆåˆ°ä¸»è¯„ä¼°æµç¨‹
4. æ›´æ–°è¯„åˆ†è®¡ç®—

**éªŒæ”¶æ ‡å‡†**:
- [ ] 65å²ç”¨æˆ·çš„è¿åŠ¨æ—¶é•¿é™åˆ¶ç”Ÿæ•ˆ
- [ ] BMI>30ç”¨æˆ·é¿å…é«˜å†²å‡»è¿åŠ¨
- [ ] ç”Ÿæˆå¯¹åº”çš„RiskFactor

---

### Task #5: é¥®é£Ÿ-è¿åŠ¨ååŒæ£€æŸ¥
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­ | **é¢„ä¼°æ—¶é—´**: 45min

**ç›®æ ‡**: æ£€æŸ¥é¥®é£Ÿæ–¹æ¡ˆä¸è¿åŠ¨æ–¹æ¡ˆçš„ååŒæ•ˆåº”

**æ£€æŸ¥é¡¹**:
1. **çƒ­é‡å¹³è¡¡**: è¿åŠ¨æ¶ˆè€— vs é¥®é£Ÿæ‘„å…¥
2. **è¥å…»æ—¶æœº**: è¿åŠ¨å‰åé¤é¥®å®‰æ’
3. **æ°´åˆ†è¡¥å……**: è¿åŠ¨å¼ºåº¦ vs æ¶²ä½“æ‘„å…¥
4. **æ¢å¤è¥å…»**: è›‹ç™½è´¨æ‘„å…¥æ—¶æœº

**å®ç°æ­¥éª¤**:
1. æ·»åŠ  `_check_diet_exercise_synergy()` æ–¹æ³•
2. åˆ†æé¥®é£Ÿæ–¹æ¡ˆçš„è¿åŠ¨æ—¥è°ƒæ•´
3. æ£€æŸ¥è›‹ç™½è´¨æ‘„å…¥æ˜¯å¦æ”¯æŒè¿åŠ¨æ¢å¤
4. ç”ŸæˆååŒå»ºè®®

**ç¤ºä¾‹**:
```python
def _check_diet_exercise_synergy(
    self,
    diet_plan: Dict,
    exercise_plan: Dict,
    user_metadata: Dict
) -> Tuple[List, List]:
    # æ£€æŸ¥è¿åŠ¨æ—¥çƒ­é‡æ˜¯å¦è¶³å¤Ÿ
    # æ£€æŸ¥è›‹ç™½è´¨æ˜¯å¦æ”¯æŒæ¢å¤
    # ...
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] èƒ½è¯†åˆ«çƒ­é‡ç¼ºå£é£é™©
- [ ] èƒ½å»ºè®®è¿åŠ¨å‰åé¤é¥®
- [ ] è¾“å‡ºå…¼å®¹æ€§è¯´æ˜

---

### Task #6: è¯¦ç»†è¯„åˆ†ç³»ç»Ÿ
**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½ | **é¢„ä¼°æ—¶é—´**: 1h

**ç›®æ ‡**: æ”¹è¿›è¯„åˆ†ç®—æ³•ï¼Œæ›´ç»†è‡´çš„å®‰å…¨è¯„ä¼°

**å½“å‰é—®é¢˜**: ç®€å•çš„é€šè¿‡/å¤±è´¥è®¡æ•° + å›ºå®šæƒ©ç½š

**æ”¹è¿›æ–¹æ¡ˆ**:
1. **å¤šç»´åº¦è¯„åˆ†**:
   - è¥å…»ç»´åº¦ (25åˆ†)
   - å®‰å…¨ç»´åº¦ (25åˆ†)
   - é€‚åˆåº¦ (25åˆ†)
   - å¯æŒç»­æ€§ (25åˆ†)

2. **åŠ¨æ€æƒé‡**:
   - æœ‰ç–¾ç—…ç”¨æˆ·: å®‰å…¨æƒé‡ +10%
   - è€å¹´äºº: å®‰å…¨æƒé‡ +15%
   - é«˜å¼ºåº¦ç›®æ ‡: å®‰å…¨æƒé‡ +10%

3. **ç´¯ç§¯é£é™©**:
   - å¤šä¸ªLOWé£é™© â†’ MODERATE
   - å¤šä¸ªMODERATEé£é™© â†’ HIGH

**å®ç°æ­¥éª¤**:
1. é‡æ„ `_calculate_score()` æ–¹æ³•
2. æ·»åŠ ç»´åº¦è¯„åˆ†è®¡ç®—
3. æ·»åŠ é£é™©ç´¯ç§¯é€»è¾‘
4. æ›´æ–° `is_safe` åˆ¤æ–­è§„åˆ™

**éªŒæ”¶æ ‡å‡†**:
- [ ] è¯„åˆ†åæ˜ å¤šç»´åº¦å¥åº·
- [ ] ç–¾ç—…ç”¨æˆ·è¯„åˆ†æ›´ä¿å®ˆ
- [ ] å¤šä¸ªä½é£é™©ç´¯ç§¯ä¸ºé«˜é£é™©

---

### Task #7: å•å…ƒæµ‹è¯•
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜ | **é¢„ä¼°æ—¶é—´**: 1h

**ç›®æ ‡**: ä¸ºsafeguardæ·»åŠ å®Œæ•´çš„å•å…ƒæµ‹è¯•

**æµ‹è¯•ç”¨ä¾‹**:

| æµ‹è¯• | è¾“å…¥ | æœŸæœ›è¾“å‡º |
|------|------|---------|
| å®‰å…¨é¥®é£Ÿ | æ­£å¸¸é¥®é£Ÿæ–¹æ¡ˆ | score >= 80, is_safe=True |
| ä½çƒ­é‡é£é™© | <1200å¡é¥®é£Ÿ | risk_factorsåŒ…å«low_calories |
| é«˜å¼ºåº¦é£é™© | å¿ƒè„ç—…+é«˜å¼ºåº¦ | is_safe=False |
| é«˜æ¸©è¿åŠ¨ | 35Â°Cæˆ·å¤–è¿åŠ¨ | risk_factorsåŒ…å«environmental |
| ç–¾ç—…ç¦å¿Œ | ç³–å°¿ç—…+é«˜ç³– | æ£€æµ‹åˆ°contraindication |

**æµ‹è¯•æ–‡ä»¶**: `tests/test_safeguard.py`

**å®ç°æ­¥éª¤**:
1. åˆ›å»º `tests/test_safeguard.py`
2. æ·»åŠ æµ‹è¯•å¤¹å…· (fixtures)
3. ç¼–å†™æµ‹è¯•ç”¨ä¾‹
4. è¿è¡ŒéªŒè¯

**éªŒæ”¶æ ‡å‡†**:
- [ ] 10+ æµ‹è¯•ç”¨ä¾‹
- [ ] è¦†ç›–ç‡ > 80%
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

### Task #8: APIç«¯ç‚¹å¢å¼º
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­ | **é¢„ä¼°æ—¶é—´**: 30min

**ç›®æ ‡**: æ·»åŠ safeguardä¸“ç”¨APIç«¯ç‚¹

**æ–°å¢ç«¯ç‚¹**:
```python
POST /api/safeguard/assess
  - è¾“å…¥: plan, plan_type, user_metadata, environment
  - è¾“å‡º: SafetyAssessment

POST /api/safeguard/batch
  - è¾“å…¥: plans: [{plan, plan_type, ...}]
  - è¾“å‡º: {assessments: [...]}

POST /api/safeguard/combined
  - è¾“å…¥: diet_plan, exercise_plan, user_metadata, environment
  - è¾“å‡º: CombinedAssessment
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] /api/safeguard/assess æ­£å¸¸å·¥ä½œ
- [ ] /api/safeguard/combined è¿”å›ååŒå»ºè®®

---

## æµ‹è¯•å‘½ä»¤

```bash
# è¿è¡Œsafeguardæµ‹è¯•
python -m pytest tests/test_safeguard.py -v

# å•ç‹¬è¿è¡Œassessoræµ‹è¯•
python -m agents.safeguard.assessor

# æµ‹è¯•pipelineé›†æˆ
python -m pipeline.health_pipeline

# å¯åŠ¨APIæµ‹è¯•
python -m core.server
# POST /api/safeguard/assess
```

---

## éªŒæ”¶é¡ºåº

1. **ä¼˜å…ˆçº§1 (Blocker)**: Task #1 - æ¨¡å‹é€‚é…
# need to access: python -m agents.safeguard.assessor
2. **ä¼˜å…ˆçº§2 (High)**: Task #7 - å•å…ƒæµ‹è¯•
3. **ä¼˜å…ˆçº§3 (High)**: Task #2 - KGé›†æˆ

---

# Milestone 4: ç®¡é“é›†æˆä¸ä¼˜åŒ– (å¾…å®ç°)

### éœ€æ±‚
```python
class HealthPlanPipeline:
    def generate(self, input_data):
        # 1. é¥®é£Ÿæ–¹æ¡ˆç”Ÿæˆ
        diet_candidates = diet_generator.generate(...)

        # 2. è¿åŠ¨æ–¹æ¡ˆç”Ÿæˆ
        exer_candidates = exer_generator.generate(...)

        # 3. å®‰å…¨è¯„ä¼°
        for plan in diet_candidates + exer_candidates:
            score = safeguard.evaluate(plan, input_data)

        # 4. æ’åºè¿”å›
        return safe_plans_sorted_by_score
```

---

# æ•°æ®éœ€æ±‚

## çŸ¥è¯†å›¾è°±æ•°æ®
- é¥®é£ŸçŸ¥è¯†å›¾è°±ï¼šé£Ÿç‰©è¥å…»æˆåˆ†è¡¨ã€é£Ÿç‰©æ­é…ç¦å¿Œã€ç–¾ç—…é¥®é£Ÿå»ºè®®
- è¿åŠ¨çŸ¥è¯†å›¾è°±ï¼šè¿åŠ¨ç±»å‹åº“ã€è¿åŠ¨æ¶ˆè€—å¡è·¯é‡Œæ•°æ®ã€è¿åŠ¨é£é™©ç³»æ•°

## æµ‹è¯•æ•°æ®
- ç”¨æˆ·metadataç¤ºä¾‹é›†
- å®‰å…¨/ä¸å®‰å…¨æ–¹æ¡ˆæ ‡æ³¨æ•°æ®
